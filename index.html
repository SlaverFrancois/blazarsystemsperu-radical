<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Directing Template">
    <meta name="keywords" content="Directing, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Directing | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/flaticon.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/barfiller.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

       <!-- Header Section Begin -->
    <header class="header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="header__logo">
                        <a href="./index.html"><img src="img/logo.png" alt=""></a>
                    </div>
                </div>
            </div>
            <div id="mobile-menu-wrap"></div>
        </div>
    </header>

   <!-- Categories Section Begin -->
    <section class="categories spad" id="categories-section">
      <div class="container">
        <div class="row" id="categories-container">
          <div class="col-lg-12">
            <div class="section-title">
              <h3>No recorras las calles buscando servicios, todos estÃ¡n aquÃ­</h3>
              <p>Encuentra el servicio que necesitas â€” de un vecino confiable cerca de ti</p>
            </div>
            <div class="categories-list-wrapper">
              <p class="section-title">Por favor elija un servicio:</p>
              <div id="alphabetical-categories"   role="navigation" aria-label="CategorÃ­as"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Categories Section End -->

    <!-- ðŸ”¹ Listado general de profesionales -->
    <section class="news-post spad" id="all-professionals-section">
      <div class="container">
        <div class="section-title d-flex justify-content-between align-items-center">
          <h2>Anunciantes destacados</h2>
        </div>
        <div class="row" id="professionals-container"></div>
      </div>
    </section>

    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="footer__about">
                        <div class="footer__about__logo">
                            <a href="./index.html"><img src="img/footer-logo.png" alt=""></a>
                        </div>
                        <p>Challenging the way things have always been done can lead to creative new options that reward
                            you.</p>
                    </div>
                </div>
                <div class="col-lg-4 offset-lg-1 col-md-6">
                    <div class="footer__address">
                        <ul>
                            <li>
                                <span>Call Us:</span>
                                <p>(+12) 345-678-910</p>
                            </li>
                            <li>
                                <span>Email:</span>
                                <p>info.colorlib@gmail .com</p>
                            </li>
                            <li>
                                <span>Connect Us:</span>
                                <div class="footer__social">
                                    <a href="#"><i class="fa fa-facebook"></i></a>
                                    <a href="#"><i class="fa fa-instagram"></i></a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
 
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="footer__copyright">
                        <div class="footer__copyright__text"><p>
  Copyright &copy;<script>document.write(new Date().getFullYear());</script> 
  Todos los derechos reservados </p>
                        </div>
                        <div class="footer__copyright__links">
                            <a href="#">Terms</a>
                            <a href="#">Privacy Policy</a>
                            <a href="#">Cookie Policy</a>
                            <a href="./listing.html">Listing</a>
                            <a href="./about.html">About</a>
                            <a href="./listing-details.html">Listing Details</a>
                            <a href="./blog-details.html">Blog Details</a>
                            <a href="./blog.html">Blog</a>
                            <a href="./contact.html">Contact</a>
                            <a href="./index.html">Home</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.barfiller.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>

 <script>
document.addEventListener('DOMContentLoaded', () => {
  // -- Variables DOM usadas en el resto del script
  const alphabetContainer = document.querySelector('#alphabetical-categories');
  const professionalsContainer = document.querySelector('#professionals-container');
  const categoriesSection = document.querySelector('#categories-section');
  const allProfessionalsSection = document.querySelector('#all-professionals-section');

    // Helper: chunk an array into sizes
  const chunk = (arr, size) => {
    const out = [];
    for (let i=0;i<arr.length;i+=size) out.push(arr.slice(i, i+size));
    return out;
  };


 // Cargar categorÃ­as y montar en columnas por letra (6 por columna)
  // Cargar categorÃ­as y montar como muro fluido de chips
// Cargar categorÃ­as y montar como muro fluido de chips
fetch('categories.json')
  .then(res => res.json())
  .then(categories => {
    const alphabetContainer = document.querySelector('#alphabetical-categories');
    const allProfessionalsSection = document.querySelector('#all-professionals-section');

    // Limpiar el contenedor
    alphabetContainer.innerHTML = '';

    // Normalizar y ordenar
    categories = categories
      .map(c => ({ ...c, title: String(c.title).trim() }))
      .sort((a, b) => a.title.localeCompare(b.title, 'es'));

    // Crear botones tipo chips
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'category-chip';
      btn.textContent = cat.title;
      btn.dataset.category = cat.title.toLowerCase();

      btn.addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          // Mostrar profesionales filtrados
          await showProfessionals(btn.dataset.category, btn);

          // Esperar un pequeÃ±o retardo y hacer scroll suave
          setTimeout(() => {
            allProfessionalsSection.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }, 200);
        } catch (err) {
          console.error(err);
        }
      });

      alphabetContainer.appendChild(btn);
    });
  })
  .catch(err => {
    console.error('Error loading categories.json', err);
  });



/**
   * showProfessionals(category?: string, sourceButton?: HTMLElement)
   * - Si category es undefined => carga inicial con todos los profesionales, mostrando destacados primero.
   * - Si category definido => filtra por categoria y ordena destacados primero.
   * - Devuelve una Promise que se resuelve cuando el render de la pÃ¡gina actual termina (Ãºtil para scrollear).
   */
  function showProfessionals(category, sourceButton) {
    return fetch('professionals.json')
      .then(res => res.json())
      .then(data => {
        // normalizar nombres de category para comparar
        const normalized = (v) => String(v || '').toLowerCase();

        // Si se pasÃ³ categorÃ­a, filtrar; si no, mostrar todos.
        let filtered = typeof category === 'string' ? data.filter(p => normalized(p.category) === normalized(category)) : data.slice();

        // ordenar: destacados (featured === true) primero
        filtered.sort((a,b) => {
          const af = a.featured === true ? 1 : 0;
          const bf = b.featured === true ? 1 : 0;
          return bf - af; // b primero si featured
        });

        // paginaciÃ³n
        const perPage = 5;
        let currentPage = 1;
        const totalPages = Math.max(1, Math.ceil(filtered.length / perPage));

        // renderPage encapsulado devuelve promesa para saber cuando terminÃ³
        const renderPage = () => {
          return new Promise((resolve) => {
            professionalsContainer.innerHTML = ''; // limpiar

            if (filtered.length === 0) {
              const empty = document.createElement('div');
              empty.className = 'col-12';
              empty.innerHTML = `<p>No hay profesionales en esta categorÃ­a.</p>`;
              professionalsContainer.appendChild(empty);
              // still append advertise-card at end even if empty
            }

            // items visibles current page
            const start = (currentPage - 1) * perPage;
            const end = start + perPage;
            const visibleItems = filtered.slice(start, end);

            visibleItems.forEach(p => {
              const divCol = document.createElement('div');
              divCol.className = 'col-lg-4 col-md-6';

              //armado de condicionales de icons

              const contactIcons = [];

if (p.contact) {

  if (p.contact.whatsapp) {
    contactIcons.push(`
      <li>
        <a href="https://wa.me/${p.contact.whatsapp}" target="_blank" class="social-icon icon-whatsapp">
          <i class="fa fa-whatsapp"></i>
        </a>
      </li>
    `);
  }

  if (p.contact.facebook) {
    contactIcons.push(`
      <li>
        <a href="${p.contact.facebook}" target="_blank" class="social-icon icon-facebook">
          <i class="fa fa-facebook"></i>
        </a>
      </li>
    `);
  }

  if (p.contact.instagram) {
    contactIcons.push(`
      <li>
        <a href="${p.contact.instagram}" target="_blank" class="social-icon icon-instagram">
          <i class="fa fa-instagram"></i>
        </a>
      </li>
    `);
  }

  if (p.contact.youtube) {
    // convertir link completo a embed
    const videoID = p.contact.youtube.split("v=")[1];
    contactIcons.push(`
      <li>
        <a href="https://www.youtube.com/embed/${videoID}?autoplay=1"
           target="_blank" class="social-icon icon-youtube">
           <i class="fa fa-youtube-play"></i> Ver
        </a>
      </li>
    `);
  }

    if (p.contact.web) {
    contactIcons.push(`
      <li>
        <a href="${p.contact.web}" target="_blank" class="social-icon icon-web" rel="noopener noreferrer">
          <i class="fa fa-globe"></i> Web
        </a>
      </li>
    `);
  }

}

//generacion de div profesional
              divCol.innerHTML = `
              <div class="blog__item professional-card d-flex">
                  
                  <!-- FOTO: 1/4 del ancho -->
                  <div class="professional-photo">
                    <img src="./fotos/${p.foto}"/>
                  </div>

                  <!-- TEXTO: 3/4 del ancho -->
                  <div class="professional-info">
                   <div class="blog__item__text">
                    <ul class="blog__item__tags">
                      <li><i class="fa fa-tags"></i> ${p.category}</li>
                    </ul>

                    <h5>${p.name || ''}</h5>
                    <p class="header__nav">${p.location || ''}</p>
                    <hr>
                    <ul class="blog__item__widget">
                      <li><i class="fa fa-star"></i><small> ${p.especiality || ''}</small></li>
                    </ul> 
                    <hr>
                    <ul id="alphabetical-categories" class:"ul-sinptos">
                      ${contactIcons.join("")}
                    </ul>
                  </div>
                  </div>

              </div>
            `;

              professionalsContainer.appendChild(divCol);
            });

            // ---- advertise-card al FINAL de la paginaciÃ³n (solicitud) ----
            const adv = document.createElement('div');
            adv.className = 'col-lg-4 col-md-6';
            adv.innerHTML = `
              <div class="blog__item advertise-card">
                <div class="blog__item__text text-center">
                  <h5>${category ? `Â¿Eres ${category}? ðŸ“¢` : 'Â¿Quieres anunciarte? ðŸ“¢'}</h5>
                  <p>AnÃºnciate aquÃ­ y llega a cientos de clientes locales.</p>
                  <a href="./landing.html" target="_blank" class="btn-advertise">Publica tu servicio</a>
                </div>
              </div>
            `;
            professionalsContainer.appendChild(adv);
            // -------------------------------------------------------------

            // PaginaciÃ³n (si hay mÃ¡s de 1 pÃ¡gina)
            const paginationWrapper = document.createElement('div');
            paginationWrapper.className = 'col-12 d-flex justify-content-center align-items-center mt-3';
            const pagination = document.createElement('div');
            pagination.className = 'blog__pagination text-center mt-4 d-flex justify-content-center flex-wrap';
            let startPage = Math.max(1, currentPage - 1);
            let endPage = Math.min(totalPages, startPage + 2);
            if (endPage - startPage < 2 && startPage > 1) startPage = Math.max(1, endPage - 2);

            let html = '';
            if (currentPage > 1) html += `<a href="#" class="prev"><i class="fa fa-long-arrow-left"></i> Anterior</a>`;
            for (let i = startPage; i <= endPage; i++) {
              html += `<a href="#" class="page-link ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</a>`;
            }
            if (currentPage < totalPages) html += `<a href="#" class="next">Siguiente <i class="fa fa-long-arrow-right"></i></a>`;

            pagination.innerHTML = html;
            paginationWrapper.appendChild(pagination);
            professionalsContainer.appendChild(paginationWrapper);

            // eventos paginaciÃ³n
            pagination.querySelectorAll('.page-link, .prev, .next').forEach(btn => {
              btn.addEventListener('click', (e) => {
                e.preventDefault();
                if (btn.classList.contains('prev') && currentPage > 1) currentPage--;
                else if (btn.classList.contains('next') && currentPage < totalPages) currentPage++;
                else if (btn.dataset.page) currentPage = parseInt(btn.dataset.page, 10);
                // re-render y resolver luego
                renderPage().then(resolve);
              });
            });

            // resolver la promesa (terminÃ³ render)
            // uso setTimeout 0 para asegurar que el DOM estÃ© pintado
            setTimeout(() => resolve(), 0);
          }); // fin promise
        }; // fin renderPage

        // Al mostrar la lista por primera vez, ocultar/mostrar secciones si deseas.
        // por requerimiento: showProfessionals debe aparecer en primera pantalla por defecto.
        // Hago scroll suave al section de profesionales (si viene del click lo gestiono afuera)
        // Render inicial:
        return renderPage().then(() => {
          // si showProfessionals fue llamado sin category (carga inicial), no forzamos scroll
          if (!category) {
            // hacemos que la secciÃ³n sea visible en primer plano: scroll to top of professionals
            // y opcionalmente ocultamos la secciÃ³n de categorÃ­as si quieres (comentado)
            // categoriesSection.style.display = 'none';
            // allProfessionalsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });
  } // fin showProfessionals

  // === Por defecto: cargar profesionales en primera pantalla ordenados por destacados ===
  // llamamos showProfessionals() sin categorÃ­a. Asegura que aparezca en la primera vista.
  showProfessionals().catch(err => console.error(err));

  // Si se hace clic en un rubro, en el handler de la construcciÃ³n de categorÃ­as llamamos:
  // showProfessionals(category, sourceButton).then(() => { scroll }).
  // Para soportar el comportamiento "scroll suave desde el botÃ³n hasta el listado ya filtrado",
  // hacemos que al resolver el render se haga scroll suave al contenedor de profesionales.
  // Nota: el handler en el enlace de cada categorÃ­a ya llamÃ³ a showProfessionals(a.dataset.category, a)
  // AsegurÃ©monos de hacer el scroll cuando promise se resuelva.
  // Para eso agregamos una pequeÃ±a colecciÃ³n que envuelva showProfessionals con scroll:
  // (implementado dentro del addEventListener previamente: showProfessionals(a.dataset.category, a).then(...))

  // Sincronizar: si el showProfessionals es llamado con sourceButton, lo scrollearÃ© al terminar:
  // para eso reescribimos temporalmente la funciÃ³n showProfessionals para reconocer el param sourceButton
  // (ya estÃ¡ siendo recibido; agrego la lÃ³gica aquÃ­ por si fue llamado con el parÃ¡metro).
  // Nota: como showProfessionals ya devuelve Promise, simplemente interceptamos llamadas directas hechas en listeners:
  // Reemplazamos los listeners arriba por: showProfessionals(..., a).then(() => allProfessionalsSection.scrollIntoView({ behavior:'smooth', block:'start' }));
  // Pero los listeners ya llaman showProfessionals(a.dataset.category, a).catch...
  // Para garantizar el scroll, adjunto un listener global que escucha clicks en .text-button y gestiona el scroll final.

  document.addEventListener('click', function(e) {
    const target = e.target;
    if (target && target.matches && target.matches('a.text-button')) {
      const category = target.dataset.category;
      // Llamo a showProfessionals y al terminar scrolleo.
      // (llamada redundante si ya se llamÃ³, pero garantiza comportamiento)
      showProfessionals(category, target).then(() => {
        // hacer scroll al bloque de profesionales suave
        // si quieres un pequeÃ±o offset para dejar header visible, cÃ¡mbialo
        allProfessionalsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }).catch(err => console.error(err));
    }
  });

});
// <-- fin DOMContentLoaded
 
</script>
 

</body>
</html>